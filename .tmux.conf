# Basic settings {{{

# Set terminal
set -g default-terminal "screen-256color"

# Automatically renumber windows
set-option -g renumber-windows on

# Disable automatic window rename
set-window-option -g automatic-rename off

# Don't let Esc interfere with vim
set -s escape-time 0

# Visual bell
set-window-option -g monitor-activity on
set -g visual-activity off

# Set terminal emulator window titles
set -g terminal-overrides "xterm*:XT:smcup@:rmcup@"
set -g set-titles on
set -g set-titles-string "#T"

# Increase scrollback buffer size from the default 2000
set-option -g history-limit 5000

# Border colors
set-option -g pane-active-border-fg colour10
set-option -g pane-border-fg colour242

# }}}

# Status bar configuration {{{

set -g status-bg colour234
set -g status-fg colour147
set -g status-attr default
set -g status-left-length 30
if-shell \
    "case $(tmux -V | cut -d' ' -f2) in 1.8|1.9) exit 0;; *) esac; exit 1" \
    "set -g status-left '#S '" \
    "set -g status-left '#S  '"
set -g status-left-attr default
set -g status-left-fg colour148
set -g status-left-bg colour234
set -g status-right ' #[fg=colour250] #H #[fg=colour148]%H:%M'
set-window-option -g window-status-bell-attr bold
set-window-option -g window-status-bell-bg colour243
set-window-option -g window-status-bell-fg colour154
set-window-option -g window-status-activity-attr default
set-window-option -g window-status-activity-bg colour243
set-window-option -g window-status-activity-fg colour81
set-window-option -g window-status-current-attr default
set-window-option -g window-status-current-bg colour75
set-window-option -g window-status-current-fg colour16
set-window-option -g window-status-current-format \
    '#[bold] #I#{?window_zoomed_flag,+,} #[nobold]#W'
set-window-option -g window-status-attr default
set-window-option -g window-status-fg colour15
set-window-option -g window-status-bg colour238
set-window-option -g window-status-format \
    '#[bold] #I#{?window_zoomed_flag,+,} #[bg=colour234]#[nobold]#W'
set-window-option -g message-bg colour11
set-window-option -g mode-bg colour11

# }}}

# Key bindings {{{

# Remap prefix to Ctrl+a
set -g prefix C-a
unbind-key C-b
bind-key a send-prefix

# Unbind Ctrl+Left and Ctrl+Right
set-window-option -g xterm-keys on
set -g terminal-overrides 'xterm*:smcup@:rmcup@'
unbind-key -n C-Left
unbind-key -n C-Right

# Use vi style mode keys
set-window-option -g mode-keys vi
# Start and end selections using <Prefix>v and <Prefix>y, respectively
# https://sanctum.geek.nz/arabesque/vi-mode-in-tmux/
bind-key -t vi-copy 'v' begin-selection
bind-key -t vi-copy 'y' copy-selection

# Enter copy mode with <Prefix>Escape or <Prefix>/
bind-key Escape copy-mode
bind-key / copy-mode

# Exit copy mode with Escape
bind-key -n -t vi-copy Escape cancel

# Swap copy mode search direction keybindings
bind-key -t vi-copy / search-backward
bind-key -t vi-copy ? search-forward

# Copy text to the system clipboard using y in copy mode
if-shell "which xclip >/dev/null 2>&1" \
    "bind -t vi-copy y copy-pipe \"xclip -sel clip -i\""
# Don't attempt to copy to the terminal clipboard
set-option -g set-clipboard off

# Move to previous/next session with Ctrl+F7 and Ctrl+F8
bind-key -n C-F7 switch-client -p
bind-key -n C-F8 switch-client -n

# Choose a session with Ctrl+e
bind-key e choose-session

# Move to previous/next window with F7 and F8
bind-key -n F7 previous-window
bind-key -n F8 next-window

# Swap windows with <
bind-key < command-prompt "swap-window -t '%%'"

# Swap panes using , and .
bind-key , swap-pane -U
bind-key . swap-pane -D

# With >, swap the current pane and the marked pane, and unmark the marked pane
bind-key > swap-pane -d \; select-pane -M

# Alt+<arrow key> pane resizing
bind -n M-Left resize-pane -L 5
bind -n M-Right resize-pane -R 5
bind -n M-Up resize-pane -U 5
bind -n M-Down resize-pane -D 5

# Reload the tmux config file with <Prefix>r
unbind r
bind r source-file ~/.tmux.conf

# Move to next pane with <Prefix>Ctrl+a
unbind C-a
bind C-a select-pane -t :.+

# Vim style new splits
unbind s
bind s split-window -v
bind v split-window -h

# Vim style full size new splits (tmux 2.3+)
if-shell \
    "case $(tmux -V | cut -d' ' -f2) in \
        [3-9]*|[2-9].[3-9]) exit 0;; *) esac; exit 1" \
    "bind H split-window -h -f -b; \
     bind J split-window -v -f; \
     bind K split-window -v -f -b; \
     bind L split-window -h -f"

# Create new windows with empty names
bind-key c new-window -n ''

# Session renaming
bind-key '$' command-prompt 'rename-session "%%"'

# Window renaming
bind-key A command-prompt 'rename-window "%%"'

# Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator
# This modifies the Ctrl+L binding recommended by vim-tmux-navigator to send
# the clear screen command when the current pane spans the full window width.
# Otherwise, <Prefix>Ctrl+L can be used to clear the screen.
# Full-width pane idea from:
# https://github.com/christoomey/vim-tmux-navigator/pull/126
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
is_full_width_pane="[ '#{pane_width}' = '#{window_width}' ]"
bind-key -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"
bind-key -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"
bind-key -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"
bind-key -n C-l if-shell "$is_vim || $is_full_width_pane" \
    "send-keys C-l" "select-pane -R"
bind-key -n C-\ if-shell "$is_vim" "send-keys C-\\" "select-pane -l"
# Bind <Prefix>Ctrl+L to clear screen
bind C-l send-keys 'C-l'

# Backup pane navigation keybindings for splits without tmux-aware vim
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

# }}}

# vim: set fdls=0 fdm=marker:
